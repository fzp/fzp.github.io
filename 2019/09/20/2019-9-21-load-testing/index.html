<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="负载测试： 设计，执行与报告"><meta name="keywords" content="Load testing,JMeter"><meta name="author" content="方镇澎"><meta name="copyright" content="方镇澎"><title>负载测试： 设计，执行与报告 | 方镇澎的博客</title><link rel="shortcut icon" href="/favicon.svg"><link rel="stylesheet" href="/css/index.css?version=1.9.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.2"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B4%9F%E8%BD%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">1.</span> <span class="toc-text">什么是负载测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">负载测试流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83"><span class="toc-number">2.1.</span> <span class="toc-text">设置环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E5%AE%9A%E8%AE%A1%E5%88%92"><span class="toc-number">2.2.</span> <span class="toc-text">制定计划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">2.3.</span> <span class="toc-text">执行计划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%8A%A5%E5%91%8A"><span class="toc-number">2.4.</span> <span class="toc-text">生成报告</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">方镇澎</div><div class="author-info__description text-center">方镇澎 Blog Slides</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">14</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">31</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">方镇澎的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">负载测试： 设计，执行与报告</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-21</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>本文讲述如何从环境设置开始到报告生成结束执行一次完整的负载测试。</p>
<a id="more"></a>

<h2 id="什么是负载测试"><a href="#什么是负载测试" class="headerlink" title="什么是负载测试"></a>什么是负载测试</h2><p>负载测试是指在具体的负载下对系统行为和表现的观测和分析。</p>
<p>在网页应用的语境下，负载通常是指并发的大量用户。</p>
<h2 id="负载测试流程"><a href="#负载测试流程" class="headerlink" title="负载测试流程"></a>负载测试流程</h2><p>一个合理的测试流程应该包含四大步骤：</p>
<ol>
<li>设置环境</li>
<li>制定计划</li>
<li>执行计划</li>
<li>生成报告</li>
</ol>
<p>具体到负载测试，流程如下：</p>
<p><img src="2019-9-21-load-testing/load-testing-process.png" alt="负载测试流程"></p>
<h3 id="设置环境"><a href="#设置环境" class="headerlink" title="设置环境"></a>设置环境</h3><p>包含步骤：<code>Testing environment setup</code></p>
<p>尽可能接近地设置成和生产环境相同的测试环境。在规模上一般小于生产环境。</p>
<h3 id="制定计划"><a href="#制定计划" class="headerlink" title="制定计划"></a>制定计划</h3><p>包含步骤：<code>Define performance criteria</code> / <code>Plan the load tests</code></p>
<p>测试计划应该详细描述整个负载测试的方方面面。一个得到测试计划的人，应该能够了解计划的目的，并且能够重新执行整个计划。</p>
<p>测试计划应该详细描述：</p>
<ol>
<li>测试背景、目的和要到达的标准</li>
<li>测试环境和范围</li>
<li>测试方法和步骤</li>
<li>测试数据的来源</li>
<li>可能的约束和问题</li>
<li>测试结果的形式并设计相应图表</li>
</ol>
<p>测试计划中性能标准通常包含延迟（Latency）、交通量（Traffic）、错误率（Errors）和饱和度（Satuation）。</p>
<p>上述四个是监控的四个黄金指标，出自Google的SRE（Site reliability engeenering）书。同样适用于负载测试。</p>
<p>对于网页应用，</p>
<p>延迟: 请求的响应时间。</p>
<p>交通量: 相当于吞吐量，每秒处理多少请求。</p>
<p>错误率: 如果是用http协议的话，看返回码是否符合预期来计算错误率。</p>
<p>饱和度: 指最受限资源的利用度。一般看系统的CPU, 内存，IO读写，网络。</p>
<p>测试计划一般会有模板，可以从收集到的模板出发，制定自己的测试计划。</p>
<h3 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h3><p>包含步骤：<code>Creation of virtual users</code> / <code>Creation of scenarios</code> / <code>Running the scenarios</code> / <code>Monitoring the scenarios</code></p>
<p>这里就是该负载测试工具出场的时候了。负载测试工具能够帮助我们模拟虚拟用户，设计场景，执行测试以及帮助收集和统计数据。</p>
<p>一个常用和成熟的测试工具是<a target="_blank" rel="noopener" href="https://jmeter.apache.org/">JMeter</a>. JMeter开源，广泛支持各类应用和协议，高扩展，支持图形界面，分布式测试等。</p>
<p>在功能和性能上，JMeter是不错的选择。但是毕竟项目成立的比较早，在配置文件上采用了XML格式，可读性差，不好编辑。一般是通过图形界面配置测试流程，测试完配置文件并保存后再以命令行的形式执行。图形界面在这里相当于一个编辑器。</p>
<p>之所以要以命令行形式执行，有几点原因：</p>
<ol>
<li>图形界面资源消耗大，影响并发数。尤其在大型测试时，容易造成JMeter崩溃。</li>
<li>命令行方式能更容易嵌入到别的测试脚本中，实现自动化测试。</li>
</ol>
<p>较现代的方式是将整个测试流程按代码编写，也即是Load test as code. 将所有的配置和测试脚本都以代码的形式给出，不需要图形界面，也容易阅读，同时也方便编写各类脚本。代码还可以托管在仓库上，在管理上也更方便了。</p>
<p>比如<a target="_blank" rel="noopener" href="https://gatling.io/">Gatling</a>就是类似的工具，但是它在支持的应用和协议上有所欠缺。部分功能需要收费，比如集群功能。</p>
<h3 id="生成报告"><a href="#生成报告" class="headerlink" title="生成报告"></a>生成报告</h3><p>包含步骤：<code>Analyze the results</code></p>
<p>最终生成的报告相对于测试计划而言，除了填写具体的测试数据外，最重要的是对测试结果的分析和最终的结论。</p>
<p>测试报告应该包含：</p>
<ol>
<li>测试结果概要</li>
<li>测试结果整理和评述</li>
<li>性能统计和趋势分析</li>
<li>性能瓶颈分析</li>
<li>存在的问题和可能的原因</li>
</ol>
<p>同样的，最终的测试报告也有相应模板，可从模板出发设计报告。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">方镇澎</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://fzp.github.io/2019/09/20/2019-9-21-load-testing/">http://fzp.github.io/2019/09/20/2019-9-21-load-testing/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Load-testing/">Load testing</a><a class="post-meta__tags" href="/tags/JMeter/">JMeter</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/09/28/2019-9-29-sftp-scp/"><i class="fa fa-chevron-left">  </i><span>SFTP和SCP</span></a></div><div class="next-post pull-right"><a href="/2019/09/19/2019-9-20-undestanding-prometheus/"><span>理解Prometheus</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By 方镇澎</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.2"></script><script src="/js/fancybox.js?version=1.9.2"></script><script src="/js/sidebar.js?version=1.9.2"></script><script src="/js/copy.js?version=1.9.2"></script><script src="/js/fireworks.js?version=1.9.2"></script><script src="/js/transition.js?version=1.9.2"></script><script src="/js/scroll.js?version=1.9.2"></script><script src="/js/head.js?version=1.9.2"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>